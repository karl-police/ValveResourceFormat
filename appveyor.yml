version: 0.1.3.{build}
image: Visual Studio 2019

dotnet_csproj:
  patch: true
  file: '**\*.csproj'
  version: '{version}'
  package_version: '{version}'
  assembly_version: '{version}'
  file_version: '{version}'
  informational_version: '{version}'

cache: '%LocalAppData%\NuGet\Cache'

build_script:
  - msbuild /t:Restore /t:Build /p:Configuration=Release

after_build:
  - dotnet pack --configuration release ValveResourceFormat\ValveResourceFormat.csproj
  - dotnet publish --configuration Release -p:PublishSingleFile=true --runtime win-x64 GUI\GUI.csproj
  - dotnet publish --configuration Release -p:PublishSingleFile=true --runtime win-x64 Decompiler\Decompiler.csproj
  - dotnet publish --configuration Release -p:PublishSingleFile=true --runtime linux-x64 Decompiler\Decompiler.csproj

artifacts:
- path: Decompiler\bin\Release\netcoreapp3.1\win-x64\publish
  name: Decompiler-win-x64
- path: Decompiler\bin\Release\netcoreapp3.1\linux-x64\publish
  name: Decompiler-linux-x64
- path: GUI\bin\Release\win-x64\publish
  name: GUI
- path: '**\*.nupkg'
  name: ValveResourceFormat
